<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thread: {{ doi }} - DOI Discussion Board</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="card card-wide">
            <div class="nav-bar">
                <a href="{{ url_for('Homepage') }}">‚Üê Back to Threads</a>
                {% if is_admin %}
                <form action="{{ url_for('delete_thread_route', thread_id=thread_id) }}" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this entire thread?');">
                    <button type="submit" class="btn-delete">Delete Thread</button>
                </form>
                {% endif %}
            </div>
            
            <h1>{{title}}</h1>
            <h2>Abstract:</h2>
            <div class="abstract-container">
                <p class="abstract-text">{{abstract}}</p>
            </div>
            <span class="doi-badge">DOI: {{ doi }}</span>
            
            <div class="comments-section">
                {% if comments %}
                    {% for comment_id, username, body in comments %}
                    <div class="comment">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <a href=" {{ url_for('userpage', username=username) }} "><div class="comment-author">{{ username }}</div></a>
                            {% if is_admin %}
                            <form action="{{ url_for('delete_comment_route', comment_id=comment_id) }}" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this comment?');">
                                <button type="submit" class="btn-delete-small">Delete</button>
                            </form>
                            {% endif %}
                        </div>
                        <div class="comment-body">{{ body | safe }}</div>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="no-comments">
                    No comments yet. Start the conversation!
                </div>
                {% endif %}
            </div>
            
            <form action="{{ url_for('send_message') }}" method="post" class="message-form">
                <textarea type="text" name="userText" placeholder="Type your message..." required></textarea>
                <input type="hidden" name="thread_id" value="{{ thread_id }}">
                <input type="hidden" name="doi" value="{{ doi }}">
                <input type="submit" value="Send">
            </form>
        </div>
    </div>
</body>
</html>